# Streaming internet radio for fun and 

Last week, internet friend [Casey](https://casey.kolderup.org) shared a post about [Icecast](https://icecast.org), a project that I'd heard about before but largely put to the side because I am (as has been noted) a fool. 

Casey was putting together a collection of various Icecast stations from Cohost, which has since bloomed into the wonderful [Cohost Icecast Webring](https://cohost-icecast-webring.glitch.me), and has been my go-to listening for the last couple days (you can read Casey's post about it [over on Cohost](https://cohost.org/ckolderup/post/4958596-the-cohost-icecast-w)). In a comment on the first post about Icecast, I joked that I was going to make a radio station that's just the barks from Warcraft 2. Unfortunately for my free time over the weekend, Casey replied "hell yeah", and I promptly set to work. Because if there's one thing that will motivate me more than anything, _it's a niche joke_.

By Sunday afternoon, what had come out of the exchange was [2 Warcraft 2 Radio](https://2-warcraft-2-radio.glitch.me/), a streaming radio station that is just the sounds from Warcraft 2 on shuffle. It's kind of impossible to listen to for more than a few minutes at a time, and sounds a lot like those drive-time radio interstitials (_"You're listening to [elephant sound] Big Tony and [bang bang bang] [monkey sound] [glass shattering] The Hoss!"_) but they never end. 

Admittedly my inclusion in the Cohost Icecast Webring is a bit of a cheat, because I couldn't quite wrap my head around Icecast proper on Saturday morning, and opted instead for an [ExpressJS](https://expressjs.com) server running on Node for familiarity and because it runs well on [Glitch](https://glitch.com). I ended up having so much fun that I made a re-mixable version of the project called [Goblin Radio Tower](https://github.com/aTylerRobertson/goblin-radio-tower), which you can play around with by either downloading the code from GitHub and running it locally, or [remixing on Glitch](https://glitch.com/~goblin-radio-tower). It's not as powerful as Icecast and doesn't have many features, but hopefully gives aspiring station-runners a decent place to start by uploading tracks and getting comfy with using a server. If you end up using it, let me know!

A few technical learns from the process, for those interested:

- I'd never tried [piping](https://nodejs.org/api/stream.html#readablepipedestination-options) files before, so that took a bit to get used to. The trick, I found, was to think of `.pipe()` as a `.forEach()` but instead of an array, it iterates through chunks of data in the file. And instead of a callback function within the `pipe()`, you use can `.on('data')` on the writeable you're piping to.
- While it is possible to interrupt piping mid-stream, I found that manually changing from one song to another would cut off current listeners, who would have to then refresh their page to keep listening. It _feels like_ there's an elegant solution for that, but not one that I could find in a weekend.
- Right now I have the stream set to a single content-type, which can be difficult if you've got songs coming from all over the place (because some will be .wav, or .mp3, or .aac, or whatever). I ended up using [ffmpeg](https://formulae.brew.sh/formula/ffmpeg) to batch-convert my files to MP3, which seemed to work best for streaming. 
- I played around with streaming video using a similar method, and couldn't quite get it to work. _In theory_ I think it should still be possible, but video likely requires a few more steps than what I've done here. 
- Icecast uses a big XML file to show the played song history (similar to an RSS feed, I think), so if you want to manually or semi-automatically grab that data you can.  I mimicked this in Goblin Radio Tower by using Socket.IO to set up web sockets and send song metadata to listeners as each song starts â€” not a perfect solution, just the first that came to mind. It would be more interesting, I think, to try doing something with RSS instead.