<!DOCTYPE html>
<html>
    <head>
        <title>Blog posts by Tyler Robertson</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <style>
            :root {
                --bg: snow;
                --text: black;
                --link: slateblue;
                --muted: gainsboro;
            }
            body {
                background-color: var(--bg);
            }
            main {
                width: 800px;
                max-width: 90vw;
                margin: 0 auto;
                font-family: serif;
                font-size: 130%;
                line-height: 130%;
                color: var(--text);
            }
            p {
                font-family: sans-serif;
            }
            a {
                color: var(--link);
            }
            h1 {
                font-size: 2.5em;
                line-height: 1em;
            }
            h1 a,
            h2 a,
            h3 a {
                text-decoration: none;
                margin-bottom: 0;
            }
            hr {
                margin: 5rem;
            }
            footer {
                margin: 3rem 0;
                text-align: right;
            }
            ul {
                padding: 0;
            }
            li {
                list-style: none;
                margin-bottom: 1em;
                border-left: 3px solid var(--link);
                padding-left: 1em;
            }
            li h2 {
                margin-bottom: 0;
            }
            li i {
                color: var(--muted);
            }
            img,
            iframe,
            video,
            canvas {
                margin: 1rem auto;
                max-width: 100%;
            }
        </style>
    </head>
    <body>
        <main>
            <h1>Blog posts by <a href="/">Tyler Robertson</a></h1>
            <a href="./rss.xml">Subscribe with RSS</a>
            <ul></ul>
        </main>
        <script async>
            const init = async () => {
                const xml = await fetch("./rss.xml");
                const text = await xml.text();
                const flatText = text.replaceAll(/\n/g, "");
                const posts = [
                    ...flatText.matchAll(/\<item\>(.+?)\<\/item\>/gi),
                ]
                    .map((post) => {
                        const postText = post.at(1);
                        return {
                            link: postText
                                .match(/\<link\>(.+?)\<\/link\>/i)
                                .at(1),
                            title: postText
                                .match(/\<title\>(.+?)\<\/title\>/i)
                                .at(1),
                            content: postText
                                .match(/\<\!\[CDATA\[(.+?)\]\]\>/i)
                                .at(1)
                                .trim(),
                            pubDate: postText
                                .match(/\<pubDate\>(.+?)\<\/pubDate\>/i)
                                .at(1),
                        };
                    })
                    .sort((a, b) => {
                        const dateA = new Date(a.pubDate);
                        const dateB = new Date(b.pubDate);
                        return dateB.valueOf() - dateA.valueOf();
                    });

                for (const post of posts) {
                    const li = document.createElement("li");
                    const a = document.createElement("a");
                    const h2 = document.createElement("h2");
                    a.setAttribute("href", post.link);
                    a.innerText = post.title;
                    const i = document.createElement("i");
                    const pubDate = new Date(post.pubDate)
                    i.innerHTML = pubDate.toLocaleString("en-GB", {
                        weekday: "long",
                        year: "numeric",
                        month: "long",
                        day: "numeric",
                        hour: "2-digit",
                        minute: "2-digit",
                        dayPeriod: "long"
                    });

                    h2.appendChild(a);
                    li.appendChild(h2);
                    li.appendChild(i);
                    document.querySelector("ul").appendChild(li);
                }
            };

            init();
        </script>
    </body>
</html>
